<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>B·∫£ng ƒêi·ªÅu Khi·ªÉn Server</title>
    <style>
      body {
        font-family: sans-serif;
        background: #222;
        color: #eee;
        margin: 0;
      }
      header {
        background: #333;
        padding: 15px 20px;
        box-shadow: 0 2px 5px #000;
      }
      .controls {
        display: flex;
        gap: 15px;
        align-items: center;
      }
      button {
        font-size: 16px;
        padding: 10px 20px;
        cursor: pointer;
        border: none;
        border-radius: 5px;
      }
      #btnStart {
        background: #28a745;
        color: white;
      }
      #btnStop {
        background: #dc3545;
        color: white;
      }
      #status {
        font-weight: bold;
      }
      .log-container {
        background: #111;
        padding: 20px;
        margin: 20px;
        border-radius: 8px;
        height: 75vh;
        overflow-y: scroll;
        font-family: monospace;
        white-space: pre-wrap;
        font-size: 14px;
        border: 1px solid #444;
      }
      .log-line {
        margin: 0;
        padding: 2px 0;
        border-bottom: 1px solid #2a2a2a;
      }
      .log-source-CPP {
        color: #81d4fa;
      } /* Xanh nhat */
      .log-source-Gateway {
        color: #c5e1a5;
      } /* Xanh la */
      .log-source-AdminPanel {
        color: #ffcc80;
        font-weight: bold;
      } /* Cam */
      .log-source-ERR {
        color: #ef9a9a;
        background: #3d1c1c;
      } /* Do */
    </style>
  </head>
  <body>
    <header>
      <div class="controls">
        <button id="btnStart">‚ñ∂Ô∏è Start Servers</button>
        <button id="btnStop">‚èπÔ∏è Stop Servers</button>
        <div id="status">Tr·∫°ng th√°i: üî¥ ƒê√£ d·ª´ng</div>
      </div>
    </header>

    <div id="log-panel" class="log-container">
      <p class="log-line">
        <span class="log-source-AdminPanel">[AdminPanel]</span>: Ch√†o m·ª´ng! H√£y
        k·∫øt n·ªëi WebSocket...
      </p>
    </div>

    <script>
      const ws = new WebSocket(`ws://${window.location.host}`);
      const logPanel = document.getElementById("log-panel");
      const statusEl = document.getElementById("status");
      const btnStart = document.getElementById("btnStart");
      const btnStop = document.getElementById("btnStop");

      ws.onopen = () => {
        logPanel.innerHTML =
          '<p class="log-line"><span class="log-source-AdminPanel">[AdminPanel]</span>: ƒê√£ k·∫øt n·ªëi v·ªõi B·∫£ng ƒêi·ªÅu Khi·ªÉn. B·∫•m "Start Servers" ƒë·ªÉ b·∫Øt ƒë·∫ßu.</p>';
        statusEl.textContent = "Tr·∫°ng th√°i: üîµ ƒê√£ k·∫øt n·ªëi (S·∫µn s√†ng)";
        statusEl.style.color = "#81d4fa";
      };

      ws.onmessage = (event) => {
        const data = JSON.parse(event.data);

        // Xac dinh class CSS
        let sourceClass = "log-source-Other";
        if (data.source.includes("C++")) sourceClass = "log-source-CPP";
        if (data.source.includes("Gateway")) sourceClass = "log-source-Gateway";
        if (data.source.includes("AdminPanel"))
          sourceClass = "log-source-AdminPanel";
        if (data.source.includes("ERR")) sourceClass = "log-source-ERR";

        // Cap nhat trang thai
        if (
          data.source === "AdminPanel" &&
          data.message.includes("ƒê√£ kh·ªüi ƒë·ªông")
        ) {
          statusEl.textContent = "Tr·∫°ng th√°i: üü¢ ƒêang ch·∫°y";
          statusEl.style.color = "#c5e1a5";
        } else if (
          data.source === "AdminPanel" &&
          data.message.includes("ƒë√£ d·ª´ng")
        ) {
          statusEl.textContent = "Tr·∫°ng th√°i: üî¥ ƒê√£ d·ª´ng";
          statusEl.style.color = "#ef9a9a";
        }

        // Hien thi log
        const p = document.createElement("p");
        p.className = "log-line";
        p.innerHTML = `<span class="${sourceClass}">[${data.source}]</span>: ${data.message}`;

        // Tu dong cuon
        const isScrolledToBottom =
          logPanel.scrollHeight - logPanel.clientHeight <=
          logPanel.scrollTop + 1;
        logPanel.appendChild(p);
        if (isScrolledToBottom) {
          logPanel.scrollTop = logPanel.scrollHeight;
        }
      };

      ws.onclose = () => {
        statusEl.textContent = "Tr·∫°ng th√°i: ‚ÄºÔ∏è L·ªói K·∫øt N·ªëi B·∫£ng ƒêi·ªÅu Khi·ªÉn";
        statusEl.style.color = "red";
      };

      // Gan su kien cho nut
      btnStart.onclick = () => ws.send("START");
      btnStop.onclick = () => ws.send("STOP");
    </script>
  </body>
</html>
